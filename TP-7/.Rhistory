knitr::opts_chunk$set(echo = FALSE)
def.chunk.hook  <- knitr::knit_hooks$get("chunk")
knitr::knit_hooks$set(chunk = function(x, options) {
x <- def.chunk.hook(x, options)
ifelse(options$size != "normalsize", paste0("\n \\", options$size,"\n\n", x, "\n\n \\normalsize"), x)
})
library(quantmod)
library(xts)
library(hornpa)
library(lubridate)
library(xtable)
library(PerformanceAnalytics)
library(TTR)
library(SuppDists)
library(lubridate)
library(roll)
library(Hmisc)
library(nFactors)
library(quadprog)
library(knitr)
library(kableExtra)
library(latex2exp)
library(FFdownload)
library(fPortfolio)
library(BLCOP)
library(mnormt)
library(portfolioBacktest)
library(riskParityPortfolio)
get.src.folder <- function() {
path.expand("../GP/src")
}
get.data.folder <- function() {
path.expand("../GP/data")
}
source(file.path(get.src.folder(), 'utils.R'))
source(file.path(get.src.folder(), 'FileUtils.R'))
daily.price.file <- "./daily.price.rda"
load(daily.price.file)
weekly.price <- daily.price[endpoints(daily.price, on="weeks", k=1),]
tickers <- names(weekly.price)
kable(table.Stats(weekly.price), "latex", booktabs=T, caption="Univers des titres") %>%
kable_styling(latex_options=c("scale_down", "HOLD_position"))
tmp <- read.csv("FEDFUNDS.csv", header=TRUE, sep=",")
rf_rate <- xts(tmp$FEDFUNDS/100.0, date(tmp$DATE))
colnames(rf_rate) <- "Rf"
# fonction pour interpoler la valeur correspondant à une date
get.rf <- function(dt) {
approx(x=index(rf_rate), y=rf_rate, xout=dt, rule=2)$y
}
plot(rf_rate, main="Taux sans risque")
ret <- diff(log(weekly.price))[-1]
cov.mat <- cov(ret)
mu <- colMeans(ret)
N <- length(colnames(ret))
w.ewp <- rep(1/nrow(cov.mat), nrow(cov.mat))
w.mat.ewp <- matrix(nrow=1,ncol=N,data = w.ewp)
colnames(w.mat.ewp) = colnames(weekly.price)
barplotPortfolioRisk(w.mat.ewp[1,], cov.mat, col = "#A29BFE")
max.sharpe.ratio <- function(data) {
prices <- data
log.ret <- diff(log(prices))[-1]
N <- ncol(prices)
Sigma <- cov(log.ret)
mu <- colMeans(log.ret)
if (all(mu <= 1e-8))
return(rep(0, N))
Dmat <- 2 * Sigma
Amat <- diag(N)
Amat <- cbind(mu, Amat)
bvec <- c(1, rep(0, N))
dvec <- rep(0, N)
res <- solve.QP(Dmat = Dmat, dvec = dvec, Amat = Amat, bvec = bvec, meq = 1)
w <- res$solution
return(w/sum(w))
}
w.tangent <- max.sharpe.ratio(weekly.price)
w.mat <- matrix(nrow=1,ncol=N,data = w.tangent)
colnames(w.mat) = colnames(weekly.price)
barplotPortfolioRisk(w.mat[1,], cov.mat, col = "#A29BFE")
rpp <- riskParityPortfolio(cov.mat)
barplotPortfolioRisk(rpp$w, cov.mat, col = "#A29BFE")
max.sharpe.ratio.2 <- function(data) {
prices <- data
log.ret <- diff(log(prices))[-1]
N <- ncol(prices)
Sigma <- cov(log.ret)
mu <- colMeans(log.ret)
if (all(mu <= 1e-8))
return(rep(0, N))
Dmat <- 2 * Sigma
Amat <- -diag(N)
Amat <- cbind(mu,Amat)
Amat <- cbind(Amat,c(rep(-1,3),rep(0,8)))
bvec <- c(0.005, rep(-0.25, N),-0.4)
dvec <- rep(0, N)
res <- solve.QP(Dmat = Dmat, dvec = dvec, Amat = Amat, bvec = bvec, meq = 1)
w <- res$solution
return(w/sum(w))
}
w.tangent.2 <- max.sharpe.ratio.2(weekly.price)
w.mat.2 <- matrix(nrow=1,ncol=N,data = w.tangent.2)
colnames(w.mat.2) <- colnames(weekly.price)
barplotPortfolioRisk(w.mat.2[1,], cov.mat, col = "#A29BFE")
Amat <- -diag(N)
Amat <- cbind(mu,Amat)
Amat <- cbind(Amat,c(rep(-1,3),rep(0,8)))
#rpp.2 <- riskParityPortfolio(cov.mat, Dmat = Amat, dvec = c(0.005, rep(-0.25, N),-0.4))
#ncol(Amat)
#length(c(0.005, rep(-0.25, N),-0.4))
#barplotPortfolioRisk(rpp.2$w, cov.mat, col = "#A29BFE")
knitr::opts_chunk$set(echo = FALSE)
def.chunk.hook  <- knitr::knit_hooks$get("chunk")
knitr::knit_hooks$set(chunk = function(x, options) {
x <- def.chunk.hook(x, options)
ifelse(options$size != "normalsize", paste0("\n \\", options$size,"\n\n", x, "\n\n \\normalsize"), x)
})
library(quantmod)
library(xts)
library(hornpa)
library(lubridate)
library(xtable)
library(PerformanceAnalytics)
library(TTR)
library(SuppDists)
library(lubridate)
library(roll)
library(Hmisc)
library(nFactors)
library(quadprog)
library(knitr)
library(kableExtra)
library(latex2exp)
library(FFdownload)
library(fPortfolio)
library(BLCOP)
library(mnormt)
library(portfolioBacktest)
library(riskParityPortfolio)
get.src.folder <- function() {
path.expand("../GP/src")
}
get.data.folder <- function() {
path.expand("../GP/data")
}
source(file.path(get.src.folder(), 'utils.R'))
source(file.path(get.src.folder(), 'FileUtils.R'))
daily.price.file <- "./daily.price.rda"
load(daily.price.file)
weekly.price <- daily.price[endpoints(daily.price, on="weeks", k=1),]
tickers <- names(weekly.price)
kable(table.Stats(weekly.price), "latex", booktabs=T, caption="Univers des titres") %>%
kable_styling(latex_options=c("scale_down", "HOLD_position"))
tmp <- read.csv("FEDFUNDS.csv", header=TRUE, sep=",")
rf_rate <- xts(tmp$FEDFUNDS/100.0, date(tmp$DATE))
colnames(rf_rate) <- "Rf"
# fonction pour interpoler la valeur correspondant à une date
get.rf <- function(dt) {
approx(x=index(rf_rate), y=rf_rate, xout=dt, rule=2)$y
}
plot(rf_rate, main="Taux sans risque")
ret <- diff(log(weekly.price))[-1]
cov.mat <- cov(ret)
mu <- colMeans(ret)
N <- length(colnames(ret))
w.ewp <- rep(1/nrow(cov.mat), nrow(cov.mat))
w.mat.ewp <- matrix(nrow=1,ncol=N,data = w.ewp)
colnames(w.mat.ewp) = colnames(weekly.price)
barplotPortfolioRisk(w.mat.ewp[1,], cov.mat, col = "#A29BFE")
max.sharpe.ratio <- function(data) {
prices <- data
log.ret <- diff(log(prices))[-1]
N <- ncol(prices)
Sigma <- cov(log.ret)
mu <- colMeans(log.ret)
if (all(mu <= 1e-8))
return(rep(0, N))
Dmat <- 2 * Sigma
Amat <- diag(N)
Amat <- cbind(mu, Amat)
bvec <- c(1, rep(0, N))
dvec <- rep(0, N)
res <- solve.QP(Dmat = Dmat, dvec = dvec, Amat = Amat, bvec = bvec, meq = 1)
w <- res$solution
return(w/sum(w))
}
w.tangent <- max.sharpe.ratio(weekly.price)
w.mat <- matrix(nrow=1,ncol=N,data = w.tangent)
colnames(w.mat) = colnames(weekly.price)
barplotPortfolioRisk(w.mat[1,], cov.mat, col = "#A29BFE")
rpp <- riskParityPortfolio(cov.mat)
barplotPortfolioRisk(rpp$w, cov.mat, col = "#A29BFE")
max.sharpe.ratio.2 <- function(data) {
prices <- data
log.ret <- diff(log(prices))[-1]
N <- ncol(prices)
Sigma <- cov(log.ret)
mu <- colMeans(log.ret)
if (all(mu <= 1e-8))
return(rep(0, N))
Dmat <- 2 * Sigma
Amat <- -diag(N)
Amat <- cbind(mu,Amat)
Amat <- cbind(Amat,c(rep(-1,3),rep(0,8)))
bvec <- c(0.005, rep(-0.25, N),-0.4)
dvec <- rep(0, N)
res <- solve.QP(Dmat = Dmat, dvec = dvec, Amat = Amat, bvec = bvec, meq = 1)
w <- res$solution
return(w/sum(w))
}
w.tangent.2 <- max.sharpe.ratio.2(weekly.price)
w.mat.2 <- matrix(nrow=1,ncol=N,data = w.tangent.2)
colnames(w.mat.2) <- colnames(weekly.price)
barplotPortfolioRisk(w.mat.2[1,], cov.mat, col = "#A29BFE")
Amat <- -diag(N)
Amat <- cbind(mu,Amat)
Amat <- cbind(Amat,c(rep(-1,3),rep(0,8)))
#rpp.2 <- riskParityPortfolio(cov.mat, Dmat = Amat, dvec = c(0.005, rep(-0.25, N),-0.4))
#ncol(Amat)
#length(c(0.005, rep(-0.25, N),-0.4))
#barplotPortfolioRisk(rpp.2$w, cov.mat, col = "#A29BFE")
