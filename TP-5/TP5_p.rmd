---
title: "Gestion de Portefeuille"
subtitle: "TP-5; Modèle de Black-Litterman"
author: Patrick Hénaff
date: "Février-Mars 2021"
output: 
  pdf_document:
    keep_tex: true
    fig_caption: yes
    latex_engine: pdflatex
    extra_dependencies: ["float"]
geometry: margin=1in

header-includes:
  - \usepackage[utf8]{inputenc}
  - \usepackage{float}
  - \floatplacement{figure}{H}

bibliography: ../../library.bib
csl: ../../apa.csl
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(fig.pos = "h", out.extra = "")
```

```{r load-libraries, include=TRUE, echo=FALSE, message=FALSE, warning=FALSE}
library(xts)
library(hornpa)
library(lubridate)
library(xtable)
library(quantmod)
library(PerformanceAnalytics)
library(TTR)
library(lubridate)
library(roll)
library(Hmisc)
library(nFactors)
library(kableExtra)
library(broom)
library(quadprog)
```

* Effectuer une lecture attentive de l'article de He et Litterman. 

* A partir de la note de cours, reproduire les autres exemples de l'article, 
comparer les résultats avec ceux obtenus avec le package BLCOP.

* Comparer avec une allocation MV classique.


```{r, echo=FALSE}
spl <- function 
(
  s,      # input string
  delim = ',' # delimiter
)
{ 
  unlist(strsplit(s,delim))
}
```

Market data from He & Litterman paper
```{r, echo=T}
 data =
'1,0.4880,0.4780,0.5150,0.4390,0.5120,0.4910
 0.4880,1,0.6640,0.6550,0.3100,0.6080,0.7790
 0.4780,0.6640,1,0.8610,0.3550,0.7830,0.6680
 0.5150,0.6550,0.8610,1,0.3540,0.7770,0.6530
 0.4390,0.3100,0.3550,0.3540,1,0.4050,0.3060
 0.5120,0.6080,0.7830,0.7770,0.4050,1,0.6520
 0.4910,0.7790,0.6680,0.6530,0.3060,0.6520,1'
  
  Corrmat = matrix( as.double(spl( gsub('\n', ',', data), ',')), 
                    nrow = length(spl(data, '\n')), byrow=TRUE)
  
  stdevs = c(16.0, 20.3, 24.8, 27.1, 21.0,  20.0, 18.7)/100
  w.eq = c(1.6, 2.2, 5.2, 5.5, 11.6, 12.4, 61.5)/100
  # Prior covariance of returns
  Sigma = Corrmat * (stdevs %*% t(stdevs))
```

Equilibrium risk premium

```{r, echo=T}
# risk aversion parameter
delta = 2.5
Pi = delta * Sigma %*% w.eq
```

Summary market data

```{r}
AssetNames = c('Australia','Canada','France','Germany','Japan','UK','USA')
Table2 = cbind(AssetNames, round(cbind(stdevs, w.eq, Pi) * 100,1))
colnames(Table2) = c('Assets','Std Dev','Weq','PI')
kable(Table2, format='latex', booktabs=T)
```
Exemple 1
```{r}
r_u <- as.numeric(Table2[6,4])
r_f <- as.numeric(Table2[3,4])
r_g <- as.numeric(Table2[4,4])
w_u <- as.numeric(Table2[6,3])
w_f <- as.numeric(Table2[3,3])
w_g <- as.numeric(Table2[4,3])
```
r_u2=r_f2+(r_u-r_f)
r_g2=((w_f*r_f2)+(w_u*r_u2))/(w_f+w_u)+0.05
w_f*r_f+w_u*r_u+w_g*r_g=w_f*r_f2+w_u*r_u2+w_g*r_g2
 
Après identification, on arrive à l'équation suivante:

```{r}
r_g2=(1/(w_f+w_g+w_u))*(w_f*r_f+w_g*r_g+w_u*r_u+5*(w_f+w_u))
r_g2
```
Nous pouvons calculer maintenant r_u2 et r_f2
```{r}
r_f2=(1/(w_f+w_u))*(w_f*r_f+w_g*r_g+w_u*r_f-w_g*r_g2)
r_f2 = round(r_f2,1)
r_f2
r_u2=r_f2+(r_u-r_f)
r_u2
```


```{r}

mu.bar=c(3.9,6.9,r_f2, r_g2,4.3,r_u2,7.6)/100
rp = mean(mu.bar)
Amat = cbind(rep(1, length(mu.bar)), mu.bar)
bvec = c(1,0.09)
dvec = t(mu.bar)
#dvec = rep(0, length(mu.bar))
Dmat =   delta * Sigma
meq = 2
res = solve.QP(Amat=Amat, bvec = bvec, dvec = dvec, Dmat = Dmat, meq = 2)
result <- matrix(nrow =1, data = res$solution)
colnames(result) <- AssetNames
result
```



















